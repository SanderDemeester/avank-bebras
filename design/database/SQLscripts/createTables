CREATE TABLE Admins (
id SERIAL,
PRIMARY KEY (id)
);

CREATE TABLE Organizers (
id SERIAL,
PRIMARY KEY (id)
);

CREATE TABLE Independents (
id SERIAL,
PRIMARY KEY (id)
);

CREATE TABLE Teachers (
id SERIAL,
telephone varchar(256) NOT NULL,
address varchar(256) NOT NULL,
PRIMARY KEY (id)
);

CREATE TABLE Users (
id text,
name text NOT NULL,
gender text NOT NULL,
birthdate date NOT NULL,
email text,
registrationDate date NOT NULL,
prefLanguage text NOT NULL,
password text NOT NULL,
hash text NOT NULL,
active bool NOT NULL,
type varchar(1),
indID integer REFERENCES Independents,
admID integer REFERENCES Admins,
teachID integer REFERENCES Teachers,
orgID integer REFERENCES Organizers,
PRIMARY KEY (id),
CHECK ( ( type = 'T' AND teachID IS NOT NULL ) 
OR ( type = 'I' AND indID IS NOT NULL )
OR ( type = 'A' AND admID IS NOT NULL )
OR ( type = 'O' AND orgID IS NOT NULL )
)
);

CREATE TABLE Schools (
id text,
name text NOT NULL,
address text NOT NULL,
PRIMARY KEY (id)
);

CREATE TABLE Classes (
id text,
name text NOT NULL,
expDate date NOT NULL,
schoolID text NOT NULL REFERENCES Schools,
teacherID integer NOT NULL REFERENCES Teachers,
level text NOT NULL,
PRIMARY KEY (id)
);

CREATE TABLE ClassPupil (
classID text REFERENCES Classes,
indID integer REFERENCES Independents,
PRIMARY KEY (classID,indID)
);

CREATE TABLE Servers (
id text,
location text NOT NULL,
PRIMARY KEY (id)
);


CREATE TABLE Questions (
id text,
type text NOT NULL,
nameDut text NOT NULL,
nameFr text NOT NULL,
nameGe text NOT NULL,
correctAnsDut text NOT NULL,
correctAnsFr text NOT NULL,
correctAnsGe text NOT NULL,
officialID text,
serverID text NOT NULL REFERENCES Servers,
path text NOT NULL,
active bool NOT NULL,
PRIMARY KEY (id)
);

CREATE TABLE OfficialContests (
id SERIAL,
PRIMARY KEY (id)
);

CREATE TABLE RestrictedContests (
id SERIAL,
PRIMARY KEY (id)
);

CREATE TABLE Contests (
id text,
name text NOT NULL,
type varchar(1) NOT NULL,
ocID integer REFERENCES OfficialContests,
rcID integer REFERENCES RestrictedContests,
active bool NOT NULL,
PRIMARY KEY (id),
CHECK ( ( type = 'O' AND ocID IS NOT NULL )
OR ( type = 'R' AND rcID IS NOT NULL )
)
);

CREATE TABLE TeacherOrganizes (
teachID integer NOT NULL REFERENCES Teachers,
rcContID integer NOT NULL REFERENCES RestrictedContests,
PRIMARY KEY (teachID,rcContID)
);

CREATE TABLE OrganizerOrganizes (
orgID integer NOT NULL REFERENCES Organizers,
ocContID integer NOT NULL REFERENCES OfficialContests,
PRIMARY KEY (orgID,ocContID)
);

CREATE TABLE ContestClasses (
classID text NOT NULL REFERENCES Classes,
contestID text NOT NULL REFERENCES Contests,
PRIMARY KEY (classID,contestID)
);

CREATE TABLE QuestionSets (
id text,
level text NOT NULL,
contID text NOT NULL REFERENCES Contests,
PRIMARY KEY (id)
);

CREATE TABLE QuestionSetQuestions (
qsID text NOT NULL REFERENCES QuestionSets,
qID text NOT NULL REFERENCES Questions,
difficulty text NOT NULL,
PRIMARY KEY (qsID,qID)
);

CREATE TABLE PupilAnswers (
indID integer NOT NULL REFERENCES Independents,
contID text NOT NULL REFERENCES Contests,
qID text NOT NULL REFERENCES Questions,
answer text NOT NULL,
PRIMARY KEY (indID,contID,qID)
);
