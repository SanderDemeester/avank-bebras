CREATE TABLE Users (
id text,
name text NOT NULL,
gender text NOT NULL,
birthdate date NOT NULL,
email text,
registrationDate date NOT NULL,
prefLanguage text NOT NULL,
password text NOT NULL,
hash text NOT NULL,
active bool NOT NULL,
type varchar(1),
telephone varchar(256),
address varchar(256),
PRIMARY KEY (id),
CHECK ( ( type = 'T' AND email IS NOT NULL AND telephone IS NOT NULL AND address IS NOT NULL ) 
OR ( type = 'I')
OR ( type = 'A')
OR ( type = 'O' )
)
);

CREATE TABLE Schools (
id text,
name text NOT NULL,
address text NOT NULL,
PRIMARY KEY (id)
);

CREATE TABLE Classes (
id text,
name text NOT NULL,
expDate date NOT NULL,
schoolID text NOT NULL REFERENCES Schools,
teacherID text NOT NULL REFERENCES Users,
level text NOT NULL,
PRIMARY KEY (id)
);

CREATE TABLE ClassPupil (
classID text REFERENCES Classes,
indID text REFERENCES Users,
PRIMARY KEY (classID,indID)
);

CREATE TABLE Servers (
id text,
location text NOT NULL,
PRIMARY KEY (id)
);


CREATE TABLE Questions (
id text,
type text NOT NULL,
nameDut text NOT NULL,
nameFr text NOT NULL,
nameGe text NOT NULL,
correctAnsDut text NOT NULL,
correctAnsFr text NOT NULL,
correctAnsGe text NOT NULL,
officialID text,
serverID text NOT NULL REFERENCES Servers,
path text NOT NULL,
active bool NOT NULL,
PRIMARY KEY (id)
);


CREATE TABLE Contests (
id text,
name text NOT NULL,
type varchar(1) NOT NULL,
active bool NOT NULL,
startTime timestamp,
endTime timestamp,
PRIMARY KEY (id),
CHECK ( type = 'O' OR type = 'R')
);

CREATE TABLE CompetitionResponsible (
userID text NOT NULL REFERENCES Users,
contID text NOT NULL REFERENCES Contests,
PRIMARY KEY (userID,contID)
);

CREATE TABLE ContestClasses (
classID text NOT NULL REFERENCES Classes,
contestID text NOT NULL REFERENCES Contests,
PRIMARY KEY (classID,contestID)
);

CREATE TABLE QuestionSets (
id text,
level text NOT NULL,
contID text NOT NULL REFERENCES Contests,
PRIMARY KEY (id)
);

CREATE TABLE QuestionSetQuestions (
qsID text NOT NULL REFERENCES QuestionSets,
qID text NOT NULL REFERENCES Questions,
difficulty text NOT NULL,
PRIMARY KEY (qsID,qID)
);

CREATE TABLE PupilAnswers (
indID text NOT NULL REFERENCES Users,
contID text NOT NULL REFERENCES Contests,
qID text NOT NULL REFERENCES Questions,
answer text NOT NULL,
PRIMARY KEY (indID,contID,qID)
);
